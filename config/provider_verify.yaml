# ProviderVerify Configuration File
# All parameters for the entity resolution pipeline

# Data sources configuration
data_sources:
  bucket_name: "provider-verify-data"
  raw_prefix: "raw/"
  processed_prefix: "processed/"
  supported_formats: ["csv", "parquet", "json"]

# Schema validation
schema:
  required_columns:
    - provider_id
    - raw_name
    - first_name
    - last_name
    - affiliation
    - address
    - phone
    - email
    - source
  
  column_types:
    provider_id: "string"
    raw_name: "string"
    first_name: "string"
    last_name: "string"
    - affiliation: "string"
    address: "string"
    phone: "string"
    email: "string"
    source: "string"

# Normalization settings
normalization:
  name:
    remove_titles: ["Dr.", "Dr", "MD", "PhD", "DO", "PA", "NP", "RN"]
    remove_suffixes: ["Jr.", "Sr.", "II", "III", "IV"]
    case_format: "title"
  
  affiliation:
    min_similarity_threshold: 0.5
    master_affiliation_file: "config/master_affiliations.csv"
  
  address:
    standardize_city_state: true
    normalize_street: true
    zip_regex: "\\d{5}(-\\d{4})?"
  
  phone:
    default_country_code: "US"
    format: "E164"
  
  email:
    case_sensitive: false
    validate_format: true

# Blocking configuration
blocking:
  strategies:
    - name: "location_name"
      keys: ["state_norm", "zip_norm[:3]", "last_name_metaphone", "first_name_soundex"]
    - name: "affiliation_tokens"
      keys: ["state_norm", "affiliation_tokens"]
      similarity_threshold: 0.5
    - name: "address_hash"
      keys: ["city_norm", "street_norm[:3]"]
  
  max_candidates_per_block: 1000

# Similarity scoring weights
scoring:
  weights:
    name_exact: 0.30
    name_fuzzy: 0.20
    name_fuzzy_fuzz: 0.15
    affiliation: 0.15
    location: 0.25
    contact: 0.10
    ml_model: 0.25  # Weight for ML model probability
  
  thresholds:
    auto_merge: 0.85
    audit_low: 0.65
    audit_high: 0.85
  
  fuzzy_thresholds:
    levenshtein_max_distance: 2
    fuzz_ratio_min: 90
    jaccard_min_similarity: 0.3

# ML model configuration
ml_model:
  algorithm: "xgboost"
  model_path: "models/provider_match.xgb"
  feature_columns:
    - name_similarity
    - affiliation_similarity
    - location_match
    - contact_match
    - name_length_diff
    - affiliation_length_diff
    - same_state
    - same_zip
    - phone_match
    - email_match
  
  training:
    test_size: 0.2
    random_state: 42
    cv_folds: 5
    early_stopping_rounds: 10

# Merge configuration
merge:
  conflict_resolution:
    strategy: "most_complete"
    keep_all_values: true
    provenance_tags: true
  
  canonical_id:
    algorithm: "uuid4_sha256"
    hash_fields: ["norm_name", "city_norm", "state_norm"]

# Audit configuration
audit:
  sample_rate: 0.07  # 7% sampling rate
  ui:
    port: 8501
    host: "localhost"
    max_records_per_page: 50
  
  feedback:
    retrain_threshold: 100  # Retrain after 100 new labels
    auto_retrain: true

# Reporting configuration
reporting:
  metrics:
    - precision
    - recall
    - f1_score
    - false_merge_rate
    - duplicate_reduction_rate
  
  dashboard:
    port: 8502
    refresh_interval: 30  # seconds

# Processing configuration
processing:
  spark:
    app_name: "ProviderVerify"
    master: "local[*]"
    executor_memory: "4g"
    driver_memory: "2g"
  
  batch_size: 10000
  parallel_workers: 4

# Security and compliance
security:
  encryption_at_rest: true
  encryption_in_transit: true
  audit_logging: true
  phi_protection:
    deidentify_logs: true
    mask_sensitive_data: true

# Logging configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/provider_verify.log"
